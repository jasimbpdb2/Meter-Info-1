<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßÅ‡¶ï‡¶Ü‡¶™</title>
    <style>
        /* Your existing CSS remains unchanged */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #f0f2f5;
            color: #333;
            line-height: 1.6;
            padding: 10px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .search-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .type-selector {
            display: flex;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }

        .type-btn {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .type-btn.active {
            background: #007bff;
            color: white;
            font-weight: bold;
        }

        .search-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
        }

        .search-btn {
            padding: 12px 24px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-family: inherit;
            transition: background 0.3s ease;
        }

        .search-btn:hover {
            background: #218838;
        }

        .search-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            color: #007bff;
            padding: 10px;
            font-size: 16px;
        }

        .error {
            display: none;
            color: #dc3545;
            background: #f8d7da;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            border: 1px solid #f5c6cb;
        }

        .data-section {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .section-title {
            background: #34495e;
            color: white;
            padding: 12px 15px;
            margin: 20px 0 15px 0;
            border-radius: 6px;
            font-weight: bold;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .subsection-title {
            background: #ecf0f1;
            color: #2c3e50;
            padding: 10px 15px;
            margin: 15px 0 10px 0;
            border-radius: 5px;
            font-weight: bold;
            border-left: 4px solid #3498db;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
        }

        .info-label {
            font-weight: bold;
            color: #2c3e50;
            min-width: 200px;
        }

        .info-value {
            color: #34495e;
            text-align: right;
            flex: 1;
        }

        .table-container {
            overflow-x: auto;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .data-table th {
            background: #2c3e50;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: bold;
            border: 1px solid #34495e;
        }

        .data-table td {
            padding: 10px 8px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .data-table tr:hover {
            background: #e3f2fd;
        }

        .amount-positive {
            color: #28a745;
            font-weight: bold;
        }

        .amount-negative {
            color: #dc3545;
            font-weight: bold;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-family: inherit;
            flex: 1;
            min-width: 120px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-print {
            background: #17a2b8;
            color: white;
        }

        .btn-print:hover {
            background: #138496;
        }

        .btn-pdf {
            background: #28a745;
            color: white;
        }

        .btn-pdf:hover {
            background: #218838;
        }

        .btn-new-search {
            background: #6c757d;
            color: white;
        }

        .btn-new-search:hover {
            background: #5a6268;
        }

        .btn-close {
            background: #dc3545;
            color: white;
        }

        .btn-close:hover {
            background: #c82333;
        }

        .emoji {
            font-size: 18px;
        }

        .summary-card {
            background: #e8f4fd;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .summary-item {
            text-align: center;
            padding: 10px;
        }

        .summary-value {
            font-size: 20px;
            font-weight: bold;
            color: #007bff;
            margin: 5px 0;
        }

        .summary-label {
            color: #666;
            font-size: 14px;
        }

        /* Debug Section Styles */
        .debug-section {
            display: none;
            background: #fff3cd;
            border: 2px dashed #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .debug-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }

        .debug-title {
            color: #856404;
            font-weight: bold;
            font-size: 16px;
        }

        .debug-content {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ffeaa7;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .debug-toggle {
            background: #ffc107;
            color: #000;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        @media (max-width: 768px) {
            .search-row {
                flex-direction: column;
            }

            .action-buttons {
                flex-direction: column;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .info-item {
                flex-direction: column;
                text-align: left;
            }

            .info-value {
                text-align: left;
                margin-top: 5px;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }
        }

        @media print {
            .search-section,
            .action-buttons,
            .debug-section {
                display: none !important;
            }

            body {
                background: white;
                padding: 0;
                margin: 0;
            }

            .data-section {
                display: block !important;
                box-shadow: none;
                padding: 0;
            }

            .section-title {
                background: #333 !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>üìä ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßÅ‡¶ï‡¶Ü‡¶™ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</h1>
            <p>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</p>
        </div>

        <!-- Search Section -->
        <div class="search-section" id="searchSection">
            <div class="type-selector">
                <button class="type-btn active" id="prepaidBtn" onclick="selectType('prepaid')">
                    ‚ö° ‡¶™‡ßç‡¶∞‡¶ø‡¶™‡ßá‡¶á‡¶° ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞
                </button>
                <button class="type-btn" id="postpaidBtn" onclick="selectType('postpaid')">
                    üí≥ ‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶™‡ßá‡¶á‡¶° ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞
                </button>
            </div>

            <div class="search-row">
                <input type="text" id="searchInput" class="search-input" 
                       placeholder="‡ßß‡ß® ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡ßá‡¶∞ ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" autofocus>
                <button onclick="fetchData()" id="searchBtn" class="search-btn">
                    üîç ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®
                </button>
            </div>

            <div class="loading" id="loading">
                ‚è≥ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá, ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...
            </div>

            <div class="error" id="error"></div>
        </div>

        <!-- Data Display Section -->
        <div class="data-section" id="dataSection">
            <div id="dataContent">
                <!-- Data will be populated by JavaScript -->
            </div>

            <!-- Debug Section -->
            <div class="debug-section" id="debugSection">
                <div class="debug-header">
                    <div class="debug-title">üêõ ‡¶°‡¶ø‡¶¨‡¶æ‡¶ó ‡¶§‡¶•‡ßç‡¶Ø</div>
                    <button class="debug-toggle" onclick="toggleDebug()">‡¶°‡¶ø‡¶¨‡¶æ‡¶ó ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶ì</button>
                </div>
                <div class="debug-content" id="debugContent">
                    <!-- Debug info will be populated here -->
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-print" onclick="window.print()">
                    üñ®Ô∏è ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü
                </button>
                <button class="btn btn-pdf" onclick="saveAsPDF()">
                    üìÑ PDF ‡¶∏‡ßá‡¶≠
                </button>
                <button class="btn btn-new-search" onclick="showSearchSection()">
                    üîÑ ‡¶®‡¶§‡ßÅ‡¶® ‡¶ñ‡ßã‡¶Å‡¶ú
                </button>
                <button class="btn btn-close" onclick="closeLookup()">
                    ‚úï ‡¶¨‡¶®‡ßç‡¶ß
                </button>
                <button class="btn" onclick="toggleDebug()" style="background: #ffc107; color: #000;">
                    üêõ ‡¶°‡¶ø‡¶¨‡¶æ‡¶ó
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentType = 'prepaid';

        function selectType(type) {
            currentType = type;

            // Update button states
            document.getElementById('prepaidBtn').classList.toggle('active', type === 'prepaid');
            document.getElementById('postpaidBtn').classList.toggle('active', type === 'postpaid');

            // Update placeholder
            const input = document.getElementById('searchInput');
            if (type === 'prepaid') {
                input.placeholder = '‡ßß‡ß® ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡ßá‡¶∞ ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®';
            } else {
                input.placeholder = '‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶Ç ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®';
            }

            // Clear previous results
            clearResults();
        }

        function fetchData() {
            const input = document.getElementById('searchInput').value.trim();
            if (!input) {
                showError('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç ‡¶¨‡¶æ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶Ç ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!');
                return;
            }

            showLoading();

            // Call Android interface
            if (window.AndroidInterface) {
                try {
                    const result = AndroidInterface.fetchLookupData(input, currentType);
                    const data = JSON.parse(result);
                    displayData(data);
                } catch (err) {
                    showError('‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ' + err.message);
                }
            } else {
                showError('AndroidInterface ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø');
            }
        }

        function displayData(data) {
            hideLoading();

            if (data.error) {
                showError(data.error);
                return;
            }

            // Show data section and hide search
            document.getElementById('searchSection').style.display = 'none';
            document.getElementById('dataSection').style.display = 'block';

            // Generate and display formatted data
            const dataContent = document.getElementById('dataContent');
            dataContent.innerHTML = generateFormattedHTML(data);

            // Show debug information
            showDebugInfo(data);
        }

        function generateFormattedHTML(data) {
            let html = '';

            // Header with meter info
            html += `<div class="section-title">
                        <span class="emoji">üìä</span> 
                        ${data.type.toUpperCase()} ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø
                    </div>`;

            // Basic Information
            html += `<div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">üî¢ ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç:</span>
                            <span class="info-value">${data.meter_number || 'N/A'}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">üë§ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶Ç:</span>
                            <span class="info-value">${data.consumer_number || data.customer_number || 'N/A'}</span>
                        </div>
                    </div>`;

            // Customer Information
            if (data.customer_info && Object.keys(data.customer_info).length > 0) {
                html += `<div class="section-title">
                            <span class="emoji">üë§</span> ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶§‡¶•‡ßç‡¶Ø
                         </div>`;

                // Personal Information
                html += `<div class="subsection-title">‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶§‡¶•‡ßç‡¶Ø</div>
                         <div class="info-grid">`;

                ['Customer Name', 'Father Name', 'Customer Address'].forEach(key => {
                    if (data.customer_info[key] && data.customer_info[key] !== 'N/A') {
                        html += `<div class="info-item">
                                    <span class="info-label">${key}:</span>
                                    <span class="info-value">${data.customer_info[key]}</span>
                                 </div>`;
                    }
                });
                html += '</div>';

                // Billing Information
                html += `<div class="subsection-title">‡¶¨‡¶ø‡¶≤‡¶ø‡¶Ç ‡¶§‡¶•‡ßç‡¶Ø</div>
                         <div class="info-grid">`;

                ['Location Code', 'Area Code', 'Bill Group', 'Book Number', 
                 'Tariff Description', 'Sanctioned Load', 'Walk Order'].forEach(key => {
                    if (data.customer_info[key] && data.customer_info[key] !== 'N/A') {
                        html += `<div class="info-item">
                                    <span class="info-label">${key}:</span>
                                    <span class="info-value">${data.customer_info[key]}</span>
                                 </div>`;
                    }
                });
                html += '</div>';

                // Technical Information
                html += `<div class="subsection-title">‡¶ü‡ßá‡¶ï‡¶®‡¶ø‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø</div>
                         <div class="info-grid">`;

                ['Usage Type', 'Description', 'Start Bill Cycle', 'Meter Condition', 'Meter Status'].forEach(key => {
                    if (data.customer_info[key] && data.customer_info[key] !== 'N/A') {
                        html += `<div class="info-item">
                                    <span class="info-label">${key}:</span>
                                    <span class="info-value">${data.customer_info[key]}</span>
                                 </div>`;
                    }
                });
                html += '</div>';
            }

            // Balance Information
            if (data.balance_info && Object.keys(data.balance_info).length > 0) {
                html += `<div class="section-title">
                            <span class="emoji">üí∞</span> ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶§‡¶•‡ßç‡¶Ø
                         </div>
                         <div class="info-grid">`;

                for (const [key, value] of Object.entries(data.balance_info)) {
                    const amount = parseFloat(value) || 0;
                    const amountClass = amount === 0 ? 'amount-positive' : 'amount-negative';
                    const displayValue = amount === 0 ? '‡ß¶.‡ß¶‡ß¶' : `‡ß≥ ${Math.abs(amount).toFixed(2)}`;

                    html += `<div class="info-item">
                                <span class="info-label">${key}:</span>
                                <span class="info-value ${amountClass}">${displayValue}</span>
                             </div>`;
                }
                html += '</div>';
            }

            // Bill Information with Table
            if (data.bill_info && data.bill_info.length > 0) {
                html += `<div class="section-title">
                            <span class="emoji">üìã</span> ‡¶¨‡¶ø‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø
                         </div>`;

                // Bill Summary
                if (data.bill_summary) {
                    html += `<div class="summary-card">
                                <div class="summary-grid">`;

                    const summary = data.bill_summary;
                    const summaryItems = [
                        { 
                            label: '‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤', 
                            value: summary.total_bills || 0, 
                            emoji: 'üìä' 
                        },
                        { 
                            label: '‡¶Æ‡ßã‡¶ü ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£', 
                            value: `‡ß≥ ${((summary.total_amount || 0)).toFixed(0)}`, 
                            emoji: 'üí∞' 
                        },
                        { 
                            label: '‡¶Æ‡ßã‡¶ü ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß', 
                            value: `‡ß≥ ${((summary.total_paid || 0)).toFixed(0)}`, 
                            emoji: 'üí≥' 
                        },
                        { 
                            label: '‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ', 
                            value: `‡ß≥ ${((summary.arrears || 0)).toFixed(0)}`, 
                            emoji: '‚ö†Ô∏è' 
                        }
                    ];

                    summaryItems.forEach(item => {
                        html += `<div class="summary-item">
                                    <div class="emoji">${item.emoji}</div>
                                    <div class="summary-value">${item.value}</div>
                                    <div class="summary-label">${item.label}</div>
                                 </div>`;
                    });

                    html += `</div></div>`;
                }

                // Bill Table
                html += `<div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>‡¶¨‡¶ø‡¶≤ ‡¶Æ‡¶æ‡¶∏</th>
                                        <th>‡¶¨‡¶ø‡¶≤ ‡¶®‡¶Ç</th>
                                        <th>‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ (kWh)</th>
                                        <th>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤</th>
                                        <th>‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§</th>
                                        <th>‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</th>
                                        <th>‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶ø‡¶§ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                    </tr>
                                </thead>
                                <tbody>`;

                data.bill_info.forEach(bill => {
                    const balance = parseFloat(bill.BALANCE) || 0;
                    const balanceClass = balance === 0 ? 'amount-positive' : 'amount-negative';
                    const balanceDisplay = balance === 0 ? '‡ß¶' : `‡ß≥ ${Math.abs(balance).toFixed(0)}`;

                    html += `<tr>
                                <td>${formatBillMonth(bill.BILL_MONTH)}</td>
                                <td>${bill.BILL_NO || 'N/A'}</td>
                                <td>${bill.CONS_KWH_SR || '‡ß¶'}</td>
                                <td>‡ß≥ ${((bill.TOTAL_BILL || 0)).toFixed(0)}</td>
                                <td>‡ß≥ ${((bill.PAID_AMT || 0)).toFixed(0)}</td>
                                <td class="${balanceClass}">${balanceDisplay}</td>
                                <td>${bill.INVOICE_DUE_DATE || 'N/A'}</td>
                            </tr>`;
                });

                html += `</tbody></table></div>`;
            }

            // Meter Readings
            if (data.meter_readings && Object.keys(data.meter_readings).length > 0) {
                html += `<div class="section-title">
                            <span class="emoji">üî¢</span> ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶°‡¶ø‡¶Ç
                         </div>
                         <div class="info-grid">`;

                for (const [key, value] of Object.entries(data.meter_readings)) {
                    if (value && value !== 'N/A' && value !== 'null') {
                        html += `<div class="info-item">
                                    <span class="info-label">${key}:</span>
                                    <span class="info-value">${value}</span>
                                 </div>`;
                    }
                }
                html += '</div>';
            }

            // Recharge History for Prepaid
            if (data.type === 'prepaid' && data.recharge_history && data.recharge_history.length > 0) {
                html += `<div class="section-title">
                            <span class="emoji">üîë</span> ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏
                         </div>
                         <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                        <th>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶Ç</th>
                                        <th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
                                        <th>‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡¶ø ‡¶ñ‡¶∞‡¶ö</th>
                                        <th>‡¶ü‡ßã‡¶ï‡ßá‡¶®</th>
                                        <th>‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶ü‡¶∞</th>
                                        <th>‡¶∏‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶∏</th>
                                    </tr>
                                </thead>
                                <tbody>`;

                data.recharge_history.slice(0, 10).forEach(transaction => {
                    html += `<tr>
                                <td>${transaction.Date || 'N/A'}</td>
                                <td>${transaction['Order Number'] || 'N/A'}</td>
                                <td>${transaction.Amount || '‡ß¶'}</td>
                                <td>${transaction['Energy Cost'] || '‡ß¶'}</td>
                                <td>${transaction.Tokens || 'N/A'}</td>
                                <td>${transaction.Operator || 'N/A'}</td>
                                <td>${transaction.Sequence || 'N/A'}</td>
                            </tr>`;
                });

                html += `</tbody></table></div>`;

                // Recharge summary
                html += `<div class="summary-card">
                            <div class="summary-item">
                                <div class="emoji">üìà</div>
                                <div class="summary-value">${data.total_recharges || data.recharge_history.length}</div>
                                <div class="summary-label">‡¶Æ‡ßã‡¶ü ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</div>
                            </div>
                         </div>`;
            }

            // Multiple Customers for Postpaid
            if (data.type === 'postpaid' && data.customer_results && data.customer_results.length > 1) {
                html += `<div class="section-title">
                            <span class="emoji">üë•</span> ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶õ‡ßá
                         </div>`;

                data.customer_results.forEach((customer, index) => {
                    html += `<div class="subsection-title">
                                ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ${index + 1}/${data.customer_results.length}
                             </div>`;

                    if (customer.customer_info) {
                        html += `<div class="info-grid">`;
                        for (const [key, value] of Object.entries(customer.customer_info)) {
                            if (value && value !== 'N/A') {
                                html += `<div class="info-item">
                                            <span class="info-label">${key}:</span>
                                            <span class="info-value">${value}</span>
                                         </div>`;
                            }
                        }
                        html += '</div>';
                    }
                });
            }

            return html;
        }

        function showDebugInfo(data) {
            const debugContent = document.getElementById('debugContent');
            let debugHTML = '';

            debugHTML += `üìä ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶æ‡¶ï‡¶ö‡¶æ‡¶∞:\n`;
            debugHTML += `‡¶ü‡¶æ‡¶á‡¶™: ${data.type || 'N/A'}\n`;
            debugHTML += `‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞: ${data.meter_number || 'N/A'}\n`;
            debugHTML += `‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï: ${data.consumer_number || data.customer_number || 'N/A'}\n\n`;

            debugHTML += `üîë ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß ‡¶ï‡ßÄ‡¶ó‡ßÅ‡¶≤‡¶ø:\n`;
            debugHTML += Object.keys(data).join(', ') + '\n\n';

            // Show customer info
            if (data.customer_info) {
                debugHTML += `üë§ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶§‡¶•‡ßç‡¶Ø (${Object.keys(data.customer_info).length}‡¶ü‡¶ø):\n`;
                Object.keys(data.customer_info).forEach(key => {
                    debugHTML += `  ${key}: ${data.customer_info[key]}\n`;
                });
                debugHTML += '\n';
            }

            // Show balance info
            if (data.balance_info) {
                debugHTML += `üí∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶§‡¶•‡ßç‡¶Ø (${Object.keys(data.balance_info).length}‡¶ü‡¶ø):\n`;
                Object.keys(data.balance_info).forEach(key => {
                    debugHTML += `  ${key}: ${data.balance_info[key]}\n`;
                });
                debugHTML += '\n';
            }

            // Show bill info
            if (data.bill_info) {
                debugHTML += `üìã ‡¶¨‡¶ø‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø: ${data.bill_info.length}‡¶ü‡¶ø ‡¶¨‡¶ø‡¶≤\n`;
                if (data.bill_info.length > 0) {
                    debugHTML += `  ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶¨‡¶ø‡¶≤: ${JSON.stringify(data.bill_info[0])}\n`;
                }
                debugHTML += '\n';
            }

            // Show recharge history
            if (data.recharge_history) {
                debugHTML += `üîã ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏: ${data.recharge_history.length}‡¶ü‡¶ø\n\n`;
            }

            debugContent.textContent = debugHTML;
        }

        function toggleDebug() {
            const debugSection = document.getElementById('debugSection');
            const debugToggle = document.querySelector('.debug-toggle');
            
            if (debugSection.style.display === 'none') {
                debugSection.style.display = 'block';
                debugToggle.textContent = '‡¶°‡¶ø‡¶¨‡¶æ‡¶ó ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶ì';
            } else {
                debugSection.style.display = 'none';
                debugToggle.textContent = '‡¶°‡¶ø‡¶¨‡¶æ‡¶ó ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì';
            }
        }

        function formatBillMonth(dateStr) {
            if (!dateStr || dateStr === 'N/A') return 'N/A';

            try {
                // Format: YYYY-MM to Month-YYYY
                const [year, month] = dateStr.split('-');
                const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                    "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

                if (month && year) {
                    const monthIndex = parseInt(month) - 1;
                    if (monthIndex >= 0 && monthIndex < 12) {
                        return `${monthNames[monthIndex]}-${year}`;
                    }
                }
                return dateStr;
            } catch (e) {
                return dateStr;
            }
        }

        function showLoading() {
            document.getElementById("loading").style.display = "block";
            document.getElementById("error").style.display = "none";
            document.getElementById("searchBtn").disabled = true;
            document.getElementById("searchBtn").textContent = "‡¶ñ‡ßÅ‡¶Å‡¶ú‡¶õ‡¶ø...";
        }

        function hideLoading() {
            document.getElementById("loading").style.display = "none";
            document.getElementById("searchBtn").disabled = false;
            document.getElementById("searchBtn").textContent = "‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®";
        }

        function showError(message) {
            const errorDiv = document.getElementById("error");
            errorDiv.textContent = message;
            errorDiv.style.display = "block";
            hideLoading();
        }

        function clearResults() {
            document.getElementById("dataContent").innerHTML = "";
            document.getElementById("error").style.display = "none";
        }

        function showSearchSection() {
            document.getElementById("dataSection").style.display = "none";
            document.getElementById("searchSection").style.display = "block";
            document.getElementById("searchInput").value = "";
            document.getElementById("searchInput").focus();
            clearResults();
        }

        function closeLookup() {
            if (window.AndroidInterface) {
                AndroidInterface.closeLookup();
            } else {
                window.close();
            }
        }

        function saveAsPDF() {
            if (window.AndroidInterface) {
                AndroidInterface.saveAsPDF();
            } else {
                window.print();
            }
        }

        // Handle Enter key press
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                fetchData();
            }
        });

        // Initialize
        document.getElementById('searchInput').focus();
    </script>
</body>
</html>