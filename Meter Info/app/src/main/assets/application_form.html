<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶™‡¶§‡ßç‡¶∞</title>

    <style>
        body {
            font-family: "Shonar Bangla", serif;
            margin: 0;
            padding: 25px 40px;
            font-size: 16px;
            line-height: 1.6;
        }

        /* Left-aligned office header */
        .header {
            text-align: left;
            font-weight: bold;
            margin-bottom: 20px;
            font-size: 18px;
        }

        /* Applicant info */
        .info-line {
            font-size: 17px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }
        .info-label {
            font-weight: normal;
            min-width: 180px;
        }
        .info-value {
            font-weight: bold;
        }

        /* Editable fields */
        .editable-field {
            border: 1px dashed #ccc;
            background: #f9f9f9;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 16px;
            width: 250px;
            font-family: "Shonar Bangla", serif;
            font-weight: bold;
        }

        .editable-field:focus {
            border-color: #3498db;
            background: #fff;
            outline: none;
        }

        .static-value {
            font-weight: bold;
        }

        /* Title */
        .title {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        /* Complaint title box */
        .complain-box {
            border: 1px solid #000;
            padding: 6px;
            width: 50%;
            margin: 10px auto 20px auto;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }

        /* Two-column area: complaints left, recharge table right */
        .content-grid {
            display: grid;
            grid-template-columns: 65% 35%;
            grid-gap: 10px;
        }

        /* Complaints list */
        .complaints p {
            margin: 3px 0;
            font-size: 17px;
            font-weight: bold;
        }

        /* Recharge section title */
        .recharge-title {
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 8px;
        }

        /* Recharge Table */
        .recharge-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 17px;
        }
        .recharge-table th, .recharge-table td {
            border: 1px solid #000;
            padding: 5px 8px;
            text-align: center;
            height: 26px;
        }

        /* Signature */
        .signature {
            text-align: right;
            margin-top: 40px;
            font-size: 18px;
            font-weight: bold;
        }

        /* Search Section Styles */
        .search-section {
            margin-bottom: 20px;
        }

        .type-selector {
            display: flex;
            margin-bottom: 10px;
        }

        .type-btn {
            padding: 8px 16px;
            border: 1px solid #ccc;
            cursor: pointer;
            margin-right: 5px;
        }

        .type-btn.active {
            background-color: #007bff;
            color: white;
        }

        .search-row {
            display: flex;
            margin-bottom: 10px;
        }

        .search-input {
            flex: 1;
            padding: 8px;
            font-size: 16px;
        }

        .search-btn {
            padding: 8px 16px;
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
        }

        .loading {
            display: none;
            color: #007bff;
        }

        .error {
            display: none;
            color: #dc3545;
        }

        .action-buttons {
            margin-top: 20px;
            text-align: center;
        }

        .btn {
            padding: 8px 16px;
            margin: 5px;
            background-color: #6c757d;
            color: white;
            border: none;
            cursor: pointer;
        }

        .form-section {
            display: none;
        }

        /* Edit mode controls */
        .edit-controls {
            margin: 10px 0;
            text-align: center;
        }

        .edit-btn {
            padding: 6px 12px;
            background-color: #ffc107;
            color: #000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>
<div class="application-container">

    <!-- Search Section -->
    <div class="search-section" id="searchSection">
        <h2 style="font-size:16px;margin-bottom:8px;">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</h2>

        <div class="debug-info" id="debugInfo" style="display:none;">
            <strong>‡¶°‡¶ø‡¶¨‡¶æ‡¶ó ‡¶§‡¶•‡ßç‡¶Ø:</strong>
            <div id="debugLog"></div>
        </div>

        <div class="type-selector">
            <div class="type-btn active" id="prepaidBtn" onclick="selectType('prepaid')">‡¶™‡ßç‡¶∞‡¶ø‡¶™‡ßá‡¶á‡¶°</div>
            <div class="type-btn" id="postpaidBtn" onclick="selectType('postpaid')">‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶™‡ßá‡¶á‡¶°</div>
        </div>

        <div class="search-row">
            <input type="text" id="searchInput" class="search-input" placeholder="‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç ‡¶¨‡¶æ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶Ç ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"
                   autofocus autocapitalize="none" autocorrect="off" inputmode="numeric">
            <button onclick="fetchData()" id="searchBtn" class="search-btn">‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</button>
        </div>

        <div class="loading" id="loading">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        <div class="error" id="error"></div>
    </div>

    <!-- Form Section -->
    <div class="form-section" id="formSection">

        <!-- Title -->
        <div class="title">‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶™‡¶§‡ßç‡¶∞</div>

        <!-- Office header (LEFT aligned) -->
        <div class="header">
            ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶π‡ßÄ ‡¶™‡ßç‡¶∞‡¶ï‡ßå‡¶∂‡¶≤‡ßÄ<br>
            ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶ì ‡¶¨‡¶ø‡¶§‡¶∞‡¶£ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó<br>
            ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶â‡¶®‡ßç‡¶®‡ßü‡¶® ‡¶¨‡ßã‡¶∞‡ßç‡¶°<br>
            ‡¶∏‡ßÅ‡¶®‡¶æ‡¶Æ‡¶ó‡¶û‡ßç‡¶ú
        </div>

        <!-- Edit Controls -->
        <div class="edit-controls">
            <button class="edit-btn" onclick="toggleEditMode()" id="editToggleBtn">‚úèÔ∏è ‡¶§‡¶•‡ßç‡¶Ø ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>

        <!-- Applicant info - NOW EDITABLE -->
        <div class="info-line">
            <span class="info-label">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï/‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ‡¶É </span>
            <span class="static-value" id="staticCustomerName">_____________</span>
            <input type="text" class="editable-field hidden" id="editableCustomerName" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
        </div>

        <div class="info-line">
            <span class="info-label">‡¶™‡¶ø‡¶§‡¶æ/‡¶∏‡ßç‡¶¨‡¶æ‡¶Æ‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ‡¶É </span>
            <span class="static-value" id="staticFatherName">_____________</span>
            <input type="text" class="editable-field hidden" id="editableFatherName" placeholder="‡¶™‡¶ø‡¶§‡¶æ/‡¶∏‡ßç‡¶¨‡¶æ‡¶Æ‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ">
        </div>

        <div class="info-line">
            <span class="info-label">‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ‡¶É </span>
            <span class="static-value" id="staticAddress">_____________</span>
            <input type="text" class="editable-field hidden" id="editableAddress" placeholder="‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ">
        </div>

        <div class="info-line">
            <span class="info-label">‡¶ü‡ßá‡¶≤‡¶ø‡¶´‡ßã‡¶® ‡¶®‡¶Ç‡¶É </span>
            <span class="static-value" id="staticMobileNo">_____________</span>
            <input type="tel" class="editable-field hidden" id="editableMobileNo" placeholder="‡¶ü‡ßá‡¶≤‡¶ø‡¶´‡ßã‡¶® ‡¶®‡¶Ç">
        </div>

        <!-- SEPARATED METER NO AND CONSUMER NO FIELDS -->
        <div class="info-line">
            <span class="info-label">‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç‡¶É </span>
            <span class="static-value" id="staticMeterNo">_____________</span>
            <input type="text" class="editable-field hidden" id="editableMeterNo" placeholder="‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç">
        </div>

        <div class="info-line">
            <span class="info-label">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶Ç‡¶É </span>
            <span class="static-value" id="staticConsumerNo">_____________</span>
            <input type="text" class="editable-field hidden" id="editableConsumerNo" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶Ç">
            <span style="margin-left: 20px;"><b>‡¶¨‡¶ï‡ßá‡ßü‡¶æ‡¶É</b> <b><span id="arrear">________</span></b></span>
        </div>

        <!-- Complaint title box -->
        <div class="complain-box">‡¶∏‡¶Æ‡ßç‡¶≠‡¶æ‡¶¨‡ßç‡¶Ø ‡¶Ö‡¶≠‡¶ø‡¶Ø‡ßã‡¶ó</div>

        <!-- Grid: Left complaints & Right recharge table -->
        <div class="content-grid">

            <!-- LEFT SIDE: COMPLAINTS -->
            <div class="complaints">
                <p>‡ßß.  ‡¶≤‡ßã‡¶° ‡¶õ‡¶æ‡ßú‡¶æ‡¶ì ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ï‡¶æ‡¶ü‡ßá / ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ï‡¶æ‡¶ü‡ßá ‡¶®‡¶æ</p>
                <p>‡ß®.  ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶ü‡ßÅ‡¶á‡¶∏‡ßç‡¶ü ‡¶∏‡ßÄ‡¶≤/‡¶≤‡ßÄ‡¶°/‡¶™‡ßç‡¶Ø‡¶æ‡¶°‡¶≤‡¶ï ‡¶∏‡ßÄ‡¶≤ ‡¶≠‡¶æ‡¶ô‡ßç‡¶ó‡¶æ / ‡¶ö‡ßÅ‡¶∞‡¶ø</p>
                <p>‡ß©.  ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶≠‡ßá‡¶ô‡ßç‡¶ó‡ßá / ‡¶π‡¶æ‡¶∞‡¶ø‡ßü‡ßá / ‡¶™‡ßÅ‡ßú‡ßá ‡¶ó‡ßá‡¶õ‡ßá</p>
                <p>‡ß™.  ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡¶æ‡¶®‡ßç‡¶§‡¶∞ / ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶Ü‡¶ó‡ßç‡¶∞‡¶π‡ßÄ</p>
                <p>‡ß´.  ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶°‡¶ø‡¶∏‡¶™‡ßç‡¶≤‡ßá‡¶§‡ßá ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶è‡¶≤‡ßã‡¶Æ‡ßá‡¶≤‡ßã</p>
                <p>‡ß¨.  ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶ü‡¶ø/‡¶™‡¶ø‡¶ü‡¶ø ‡¶®‡¶∑‡ßç‡¶ü</p>
                <p>‡ß≠.  ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶π‡¶æ‡¶∞‡¶ø‡ßü‡ßá‡¶õ‡ßá</p>
                <p>‡ßÆ.  ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ</p>
                <p>‡ßØ.  ‡¶ü‡¶æ‡¶∞‡ßç‡¶Æ‡¶ø‡¶®‡¶æ‡¶≤ ‡¶ï‡¶≠‡¶æ‡¶∞ ‡¶ñ‡ßÅ‡¶≤‡ßá ‡¶ó‡ßá‡¶õ‡ßá</p>
                <p>‡ßß‡ß¶. ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü ‡¶®‡ßá‡¶á</p>
                <p>‡ßß‡ßß. ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá ‡¶°‡ßá‡¶ü/‡¶ü‡¶æ‡¶á‡¶Æ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡¶æ</p>
                <p>‡ßß‡ß®. ‡¶®‡¶æ‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®</p>
                <p>‡ßß‡ß©. ‡¶≤‡ßã‡¶° ‡¶¨‡ßÉ‡¶¶‡ßç‡¶ß‡¶ø ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®</p>
                <p>‡ßß‡ß™. ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∞‡¶ø/‡¶≤‡ßã-‡¶≠‡ßã‡¶≤‡ßç‡¶ü‡ßá‡¶ú ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ</p>
                <p>‡ßß‡ß´. ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá ‡¶ï‡ßã‡¶® ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</p>
                <p>‡ßß‡ß¨. ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø __________________________________________</p>
            </div>

            <!-- RIGHT SIDE: RECHARGE TABLE -->
            <div id="rechargeSection">
                <div class="recharge-title">‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</div>

                <table class="recharge-table" id="rechargeTable">
                    <tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th></tr>
                    <tr><td id="rechargeDate1">&nbsp;</td><td id="rechargeAmount1">&nbsp;</td></tr>
                    <tr><td id="rechargeDate2">&nbsp;</td><td id="rechargeAmount2">&nbsp;</td></tr>
                    <tr><td id="rechargeDate3">&nbsp;</td><td id="rechargeAmount3">&nbsp;</td></tr>
                </table>
            </div>

        </div>

        <!-- Signature -->
        <div class="signature">
            ...........................<br>
            ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶∏‡¶æ‡¶ï‡ßç‡¶∑‡¶∞
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn" onclick="window.print()">üñ®Ô∏è ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü</button>
            <button class="btn" onclick="saveAsPDF()">üìÑ PDF ‡¶∏‡ßá‡¶≠</button>
            <button class="btn" onclick="showSearchSection()">‚Üê ‡¶®‡¶§‡ßÅ‡¶® ‡¶ñ‡ßã‡¶Å‡¶ú</button>
            <button class="btn" onclick="closeForm()">‚úï ‡¶¨‡¶®‡ßç‡¶ß</button>
        </div>

    </div>
</div>

<script>
// Add PDF save function (keeps original logic)
function saveAsPDF() {
    if (window.AndroidInterface && AndroidInterface.saveAsPDF) {
        AndroidInterface.saveAsPDF();
    } else {
        // Fallback to print on mobile
        alert('PDF ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶Ö‡¶™‡¶∂‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®');
        window.print();
    }
}

/* ------- WORKING JS LOGIC FROM YOUR WORKING CODE ------- */
let selectedType = 'prepaid';
let currentCustomerType = 'prepaid'; // Track current displayed customer type
let currentInputNumber = ''; // Store the input number
let isEditMode = false; // Track edit mode

function debugLog(msg){
    const d=document.getElementById("debugLog");
    if(d){ d.innerHTML+=msg+"<br>"; d.scrollTop=d.scrollHeight; }
}

function selectType(t){
    selectedType=t;
    document.getElementById("prepaidBtn").classList.toggle("active",t==="prepaid");
    document.getElementById("postpaidBtn").classList.toggle("active",t==="postpaid");

    // Update placeholder based on type
    const input = document.getElementById("searchInput");
    if (t === 'prepaid') {
        input.placeholder = '‡ßß‡ß® ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡ßá‡¶∞ ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®';
    } else {
        input.placeholder = '‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶Ç ‡¶¨‡¶æ ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®';
    }
}

function fetchData(){
    const input=document.getElementById("searchInput").value.trim();
    if(!input){ showError("‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç ‡¶¨‡¶æ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶Ç ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!"); return; }

    currentInputNumber = input; // Store the input number
    showLoading();

    if(window.AndroidInterface){
        try{
            const result=AndroidInterface.fetchDataForApplication(input,selectedType);
            const data=JSON.parse(result);
            currentCustomerType = selectedType; // Set current customer type
            fillFormWithData(data);
        }catch(err){ showError("App error: "+err); }
    } else {
        showError("AndroidInterface not available");
    }
}

function fillFormWithData(data){
    hideLoading();
    if(data.error){ showError(data.error); return; }

    // Fill both static and editable fields with API data
    const fields = [
        { static: 'staticCustomerName', editable: 'editableCustomerName', value: data.customer_name },
        { static: 'staticFatherName', editable: 'editableFatherName', value: data.father_name },
        { static: 'staticAddress', editable: 'editableAddress', value: data.address },
        { static: 'staticMobileNo', editable: 'editableMobileNo', value: data.mobile_no }
    ];

    fields.forEach(field => {
        const displayValue = field.value || '_____________';
        document.getElementById(field.static).textContent = displayValue;
        document.getElementById(field.editable).value = field.value || '';
    });

    // Handle meter number and consumer number based on customer type
    if (currentCustomerType === 'prepaid') {
        // For prepaid: show input number as meter number, data.consumer_no as consumer number
        document.getElementById("staticMeterNo").textContent = currentInputNumber || "_____________";
        document.getElementById("editableMeterNo").value = currentInputNumber || "";
        document.getElementById("staticConsumerNo").textContent = data.consumer_no || "_____________";
        document.getElementById("editableConsumerNo").value = data.consumer_no || "";
    } else {
        // For postpaid: show data.meter_no as meter number, input number as consumer number
        document.getElementById("staticMeterNo").textContent = data.meter_no || "_____________";
        document.getElementById("editableMeterNo").value = data.meter_no || "";
        document.getElementById("staticConsumerNo").textContent = currentInputNumber || "_____________";
        document.getElementById("editableConsumerNo").value = currentInputNumber || "";
    }

    // Handle arrear - using the same logic as working code
    document.getElementById("arrear").textContent = (data.arrear && data.arrear!=="0") ? data.arrear : "‡¶ï‡ßã‡¶®‡¶ì ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶®‡ßá‡¶á";

    // Handle recharge section based on customer type
    const rechargeSection = document.getElementById("rechargeSection");
    if (currentCustomerType === 'prepaid') {
        // Show and fill recharge data for prepaid
        rechargeSection.style.display = 'block';

        const rechargeData = data.recharges || [];

        // Clear existing data
        for (let i = 1; i <= 3; i++) {
            document.getElementById(`rechargeDate${i}`).textContent = "";
            document.getElementById(`rechargeAmount${i}`).textContent = "";
        }

        // Fill with new data
        let count = 0;
        rechargeData.slice(0, 3).forEach(r=>{
            count++;
            document.getElementById(`rechargeDate${count}`).textContent = r.Date||"-";
            document.getElementById(`rechargeAmount${count}`).textContent = r.Amount||"-";
        });

        // Show empty rows for remaining slots
        for (let i = count + 1; i <= 3; i++) {
            document.getElementById(`rechargeDate${i}`).innerHTML = "&nbsp;";
            document.getElementById(`rechargeAmount${i}`).innerHTML = "&nbsp;";
        }
    } else {
        // Hide recharge section for postpaid
        rechargeSection.style.display = 'none';
    }

    // Ensure we're in view mode when data loads
    if (isEditMode) {
        toggleEditMode(); // Switch back to view mode
    }

    document.getElementById("searchSection").style.display="none";
    document.getElementById("formSection").style.display="block";
}

// Toggle between view and edit mode
function toggleEditMode() {
    isEditMode = !isEditMode;
    const editBtn = document.getElementById("editToggleBtn");

    if (isEditMode) {
        // Switch to edit mode
        document.querySelectorAll('.static-value').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('.editable-field').forEach(el => el.classList.remove('hidden'));
        editBtn.textContent = 'üíæ ‡¶è‡¶°‡¶ø‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®';
        editBtn.style.backgroundColor = '#28a745';
    } else {
        // Switch to view mode and save changes
        document.querySelectorAll('.static-value').forEach(el => {
            const fieldId = el.id.replace('static', 'editable');
            const inputValue = document.getElementById(fieldId).value;
            el.textContent = inputValue || '_____________';
            el.classList.remove('hidden');
        });
        document.querySelectorAll('.editable-field').forEach(el => el.classList.add('hidden'));
        editBtn.textContent = '‚úèÔ∏è ‡¶§‡¶•‡ßç‡¶Ø ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®';
        editBtn.style.backgroundColor = '#ffc107';
        
        // Optional: Save the edited data back to app
        saveEditedData();
    }
}

// Save edited data back to Android app
function saveEditedData() {
    const editedData = {
        customerName: document.getElementById('editableCustomerName').value,
        fatherName: document.getElementById('editableFatherName').value,
        address: document.getElementById('editableAddress').value,
        mobileNo: document.getElementById('editableMobileNo').value,
        meterNo: document.getElementById('editableMeterNo').value,
        consumerNo: document.getElementById('editableConsumerNo').value
    };

    if (window.AndroidInterface && AndroidInterface.saveEditedData) {
        AndroidInterface.saveEditedData(JSON.stringify(editedData));
    }
}

function showLoading(){
    document.getElementById("loading").style.display="block";
    document.getElementById("searchBtn").disabled=true;
    document.getElementById("searchBtn").textContent="‡¶ñ‡ßÅ‡¶Å‡¶ú‡¶õ‡¶ø...";
}

function hideLoading(){
    document.getElementById("loading").style.display="none";
    document.getElementById("searchBtn").disabled=false;
    document.getElementById("searchBtn").textContent="‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®";
}

function showError(m){
    const err = document.getElementById("error");
    if(err){ err.textContent=m; err.style.display="block"; }
    hideLoading();
}

function hideError(){ const e=document.getElementById("error"); if(e) e.style.display="none"; }

function showSearchSection(){
    document.getElementById("formSection").style.display="none";
    document.getElementById("searchSection").style.display="block";
    // Reset recharge section visibility when going back to search
    document.getElementById("rechargeSection").style.display = 'block';
    // Clear stored input number
    currentInputNumber = '';
    // Reset to view mode
    if (isEditMode) {
        toggleEditMode();
    }
}

function closeForm(){
    if(window.AndroidInterface){ AndroidInterface.closeApplication(); }
}

document.addEventListener('DOMContentLoaded', () => {
    selectType(selectedType);
});

// Allow Enter key to search
document.getElementById("searchInput").addEventListener("keypress", function(e) {
    if (e.key === "Enter") {
        fetchData();
    }
});
</script>
</body>
</html>