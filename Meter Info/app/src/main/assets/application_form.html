<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶™‡¶§‡ßç‡¶∞</title>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    padding: 20px;
    background: #f0f2f5;
}

/* A4 Print Optimization */
@page {
    size: A4;
    margin: 15mm;
}

@media print {
    body {
        margin: 0;
        padding: 0;
        background: white;
        /* A4 paper width simulation */
        width: 210mm; 
        min-height: 297mm;
    }
    .search-section, .action-buttons, .debug-info {
        display: none !important;
    }
    .application-container {
        box-shadow: none !important;
        border-radius: 0 !important;
        margin: 0 !important;
        width: 100% !important;
        padding: 0 15mm !important; /* Apply margin from @page to content */
    }
    .form-section { 
        display: block !important; 
        padding: 0;
    }
    /* Ensure the header text is centered in print */
    .header h1 {
        text-align: center !important;
    }
    .header p {
        text-align: left !important;
    }
    .signature {
        margin-top: 50px; /* Space for signature */
        text-align: right;
    }
}

/* Main container */
.application-container {
    max-width: 900px;
    margin: 0 auto;
    background: white;
    border-radius: 10px;
    padding: 25px;
    box-shadow: 0 3px 12px rgba(0,0,0,0.1);
}

/* SEARCH BOX SECTION */
.search-section {
    background: #ffffff;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    border: 1px solid #dee2e6;
}

.type-selector { display: flex; gap: 10px; margin-bottom: 15px; }
.type-btn {
    flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 6px;
    background: white; cursor: pointer; text-align: center; transition: 0.25s;
}
.type-btn.active { background: #007bff; color: white; border-color: #007bff; }

.search-row { display: flex; gap: 10px; align-items: center; }
.search-input {
    flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 6px;
}
.search-btn {
    background: #007bff; color: white; border: none;
    padding: 12px 20px; border-radius: 6px; cursor: pointer;
}
.search-btn:disabled { background: #6c757d; }

.loading { display: none; color: #007bff; text-align: center; padding: 10px; }
.error {
    display: none; color: #dc3545; background: #f8d7da;
    border: 1px solid #f5c6cb; border-radius: 6px; padding: 10px; margin-top: 10px;
}

.debug-info {
    background: #fafafa; border: 1px solid #ddd; border-radius: 6px;
    padding: 10px; margin-top: 10px; font-size: 12px; color: #6c757d;
    max-height: 150px; overflow-y: auto;
}

/* HEADER ‚Äî modern layout */
.header {
    margin-bottom: 25px;
    padding-bottom: 20px;
    border-bottom: 2px solid #007bff;
}

/* Center title only */
.header h1 {
    text-align: center !important;
    font-size: 30px;
    color: #2c3e50;
    margin-bottom: 15px;
}

/* Left-align office block */
.header p {
    text-align: left !important;
    font-size: 18px;
    line-height: 1.4;
    color: #444;
}

/* FORM TABLE */
.form-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 30px;
    font-size: 17px;
}
.form-table td {
    padding: 12px; border: 1px solid #ddd; vertical-align: top;
}
.form-table td:first-child {
    font-weight: bold; width: 32%; background: #f8f9fa;
}

/* RECHARGE TABLE */
.recharge-section { margin-top: 30px; }
.recharge-table { width: 100%; border-collapse: collapse; }
.recharge-table th, .recharge-table td {
    padding: 10px; border: 1px solid #ccc; text-align: center;
}
.recharge-table th { background: #007bff; color: white; }
.recharge-table tr:nth-child(even) { background: #f8f9fa; }

/* NOTES section */
.notes { margin-top: 30px; padding: 10px; font-size: 17px; }
.notes strong { display: block; margin-bottom: 10px; }

/* SIGNATURE */
.signature {
    margin-top: 40px; text-align: right; padding: 20px;
}
.sig-line {
    border-top: 1px solid #000; width: 220px; margin-left: auto; padding-top: 5px;
}

/* ACTION BUTTONS */
.action-buttons {
    display: flex; gap: 15px; justify-content: center;
    margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;
}
.btn {
    padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer;
    font-size: 16px;
}
.btn-print { background: #28a745; color: white; }
.btn-close { background: #dc3545; color: white; }
.btn-back { background: #6c757d; color: white; }
    </style>
</head>

<body>
<div class="application-container">

    <div class="search-section" id="searchSection">
        <h2>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</h2>

        <div class="debug-info" id="debugInfo">
            <strong>‡¶°‡¶ø‡¶¨‡¶æ‡¶ó ‡¶§‡¶•‡ßç‡¶Ø:</strong>
            <div id="debugLog"></div>
        </div>

        <div class="type-selector">
            <div class="type-btn active" id="prepaidBtn" onclick="selectType('prepaid')">‡¶™‡ßç‡¶∞‡¶ø‡¶™‡ßá‡¶á‡¶°</div>
            <div class="type-btn" id="postpaidBtn" onclick="selectType('postpaid')">‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶™‡ßá‡¶á‡¶°</div>
        </div>

        <div class="search-row">
            <input type="text" id="searchInput" class="search-input" placeholder="‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç ‡¶¨‡¶æ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶Ç ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"
                   autofocus autocapitalize="none" autocorrect="off" inputmode="numeric">
            <button onclick="fetchData()" id="searchBtn" class="search-btn">‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</button>
        </div>

        <div class="loading" id="loading">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        <div class="error" id="error"></div>
    </div>

    <div class="form-section" id="formSection">

        <div class="header">
            <h1>‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶™‡¶§‡ßç‡¶∞</h1>
            <p>‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶π‡ßÄ ‡¶™‡ßç‡¶∞‡¶ï‡ßå‡¶∂‡¶≤‡ßÄ<br>‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º ‡¶ì ‡¶¨‡¶ø‡¶§‡¶∞‡¶£ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó<br>‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶â‡¶®‡ßç‡¶®‡¶Ø‡¶º‡¶® ‡¶¨‡ßã‡¶∞‡ßç‡¶°, ‡¶∏‡ßÅ‡¶®‡¶æ‡¶Æ‡¶ó‡¶û‡ßç‡¶ú‡•§</p>
        </div>

        <table class="form-table">
            <tr><td>‡ßß‡•§ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ‡¶É</td><td id="customerName">-</td></tr>
            <tr><td>‡¶™‡¶ø‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ‡¶É</td><td id="fatherName">-</td></tr>
            <tr><td>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ‡¶É</td><td id="address">-</td></tr>
            <tr><td>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Ç‡¶É</td><td id="mobileNo">-</td></tr>
            <tr><td>‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç‡¶É</td><td id="meterNo">-</td></tr>
            <tr><td>‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶Ç‡¶É</td><td id="consumerNo">-</td></tr>
            <tr><td>‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ü‡¶æ‡¶ï‡¶æ‡¶É</td><td id="arrear">‡¶ï‡ßã‡¶®‡¶ì ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶®‡ßá‡¶á</td></tr>
        </table>

        <div class="recharge-section">
            <h3>‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø (‡¶™‡ßç‡¶∞‡¶ø‡¶™‡ßá‡¶á‡¶°)</h3>
            <table class="recharge-table" id="rechargeTable">
                <thead>
                <tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th></tr>
                </thead>
                <tbody>
                <tr><td>-</td><td>-</td></tr>
                <tr><td>-</td><td>-</td></tr>
                <tr><td>-</td><td>-</td></tr>
                <tr><td>-</td><td>-</td></tr>
                </tbody>
            </table>
        </div>

        <section class="notes">
            <strong>‡¶∏‡¶Æ‡ßç‡¶≠‡¶æ‡¶¨‡ßç‡¶Ø ‡¶Ö‡¶≠‡¶ø‡¶Ø‡ßã‡¶ó (‡¶Ø‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶§‡¶æ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®):</strong>
            <ol>
                <li><input type="checkbox"> ‡¶≤‡ßã‡¶° ‡¶õ‡¶æ‡ßú‡¶æ‡¶ì ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ï‡¶æ‡¶ü‡ßá / ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ï‡¶æ‡¶ü‡ßá ‡¶®‡¶æ</li>
                <li><input type="checkbox"> ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ü‡ßÅ‡¶á‡¶∏‡ßç‡¶ü ‡¶ü‡¶æ‡¶á‡¶™ ‡¶∏‡ßÄ‡¶≤ / ‡¶≤‡ßÄ‡¶° / ‡¶™‡ßç‡¶Ø‡¶æ‡¶°‡¶≤‡¶ï ‡¶∏‡ßÄ‡¶≤ ‡¶≠‡¶æ‡¶ô‡¶æ / ‡¶ö‡ßÅ‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá</li>
                <li><input type="checkbox"> ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶≠‡ßá‡¶ô‡ßá / ‡¶π‡¶æ‡¶∞‡¶ø‡ßü‡ßá / ‡¶™‡ßÅ‡ßú‡ßá ‡¶ó‡ßá‡¶õ‡ßá</li>
                <li><input type="checkbox"> ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡¶æ‡¶®‡ßç‡¶§‡¶∞ / ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶Ü‡¶ó‡ßç‡¶∞‡¶π‡ßÄ</li>
                <li><input type="checkbox"> ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶°‡¶ø‡¶∏‡¶™‡ßç‡¶≤‡ßá‡¶§‡ßá ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶è‡¶≤‡ßã‡¶Æ‡ßá‡¶≤‡ßã</li>
                <li><input type="checkbox"> ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶ü‡¶ø / ‡¶™‡¶ø‡¶ü‡¶ø ‡¶®‡¶∑‡ßç‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá</li>
                <li><input type="checkbox"> ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶π‡¶æ‡¶∞‡¶ø‡ßü‡ßá ‡¶ó‡ßá‡¶õ‡ßá</li>
                <li><input type="checkbox"> ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶õ‡ßá ‡¶®‡¶æ</li>
                <li><input type="checkbox"> ‡¶ü‡¶æ‡¶∞‡ßç‡¶Æ‡¶ø‡¶®‡¶æ‡¶≤ ‡¶ï‡¶≠‡¶æ‡¶∞ ‡¶ñ‡ßÅ‡¶≤‡ßá ‡¶´‡ßá‡¶≤‡ßá‡¶õ‡¶ø / ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßá‡¶â ‡¶ñ‡ßÅ‡¶≤‡ßá‡¶õ‡ßá</li>
                <li><input type="checkbox"> ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü ‡¶®‡ßá‡¶á</li>
                <li><input type="checkbox"> ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ / ‡¶∏‡¶Æ‡ßü ‡¶†‡¶ø‡¶ï ‡¶®‡ßá‡¶á</li>
                <li><input type="checkbox"> ‡¶®‡¶æ‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®</li>
                <li><input type="checkbox"> ‡¶≤‡ßã‡¶° ‡¶¨‡ßÉ‡¶¶‡ßç‡¶ß‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®</li>
                <li><input type="checkbox"> ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∞‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ / ‡¶≤‡ßã-‡¶≠‡ßã‡¶≤‡ßç‡¶ü‡ßá‡¶ú ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ</li>
                <li><input type="checkbox"> ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</li>
                <li><input type="checkbox"> ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø .....................................................................................</li>
            </ol>
        </section>

        <div class="signature">
            <div class="sig-line">‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</div>
        </div>

        <div class="action-buttons">
            <button class="btn btn-print" onclick="window.print()">üñ®Ô∏è ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü</button>
            <button class="btn btn-close" onclick="closeForm()">‚úï ‡¶¨‡¶®‡ßç‡¶ß</button>
            <button class="btn btn-back" onclick="showSearchSection()">‚Üê ‡¶®‡¶§‡ßÅ‡¶® ‡¶ñ‡ßã‡¶Å‡¶ú</button>
        </div>

    </div>
</div>

<script>
/* ------- MODIFIED JS LOGIC ------- */

let selectedType = 'prepaid';

function debugLog(msg){
    const d=document.getElementById("debugLog");
    d.innerHTML+=msg+"<br>";
    d.scrollTop=d.scrollHeight;
}

function selectType(t){
    selectedType=t;
    document.getElementById("prepaidBtn").classList.toggle("active",t==="prepaid");
    document.getElementById("postpaidBtn").classList.toggle("active",t==="postpaid");
}

function fetchData(){
    const input=document.getElementById("searchInput").value.trim();
    if(!input){ showError("‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡¶Ç ‡¶¨‡¶æ ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶®‡¶Ç ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!"); return; }

    showLoading();

    if(window.AndroidInterface){
        try{
            // Assuming AndroidInterface.fetchDataForApplication returns the combined data object (Server 1 data + status for others)
            const result=AndroidInterface.fetchDataForApplication(input,selectedType);
            const data=JSON.parse(result);
            fillFormWithData(data);
        }catch(err){ showError("App error: "+err); }
    } else {
        showError("AndroidInterface not available");
    }
}

function fillFormWithData(data){
    hideLoading();
    if(data.error){ showError(data.error); return; }

    document.getElementById("customerName").textContent=data.customer_name||"-";
    document.getElementById("fatherName").textContent=data.father_name||"-";
    document.getElementById("address").textContent=data.address||"-";
    document.getElementById("mobileNo").textContent=data.mobile_no||"-";
    document.getElementById("meterNo").textContent=data.meter_no||"-";
    document.getElementById("consumerNo").textContent=data.consumer_no||"-";

    // ‚úÖ Arrear Logic Change: Replaces "..........." with "‡¶ï‡ßã‡¶®‡¶ì ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶®‡ßá‡¶á"
    document.getElementById("arrear").textContent =
        (data.arrear && data.arrear!=="0") ? data.arrear : "‡¶ï‡ßã‡¶®‡¶ì ‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ ‡¶®‡ßá‡¶á";
    
    // Recharge Table Filling Logic (No change)
    const tbody=document.getElementById("rechargeTable").querySelector("tbody");
    tbody.innerHTML="";
    
    let rechargeData = data.recharges || [];
    let count = 0;
    
    rechargeData.slice(0, 4).forEach(r=>{
        tbody.innerHTML+=`<tr><td>${r.Date||"-"}</td><td>${r.Amount||"-"}</td></tr>`;
        count++;
    });
    
    // Fill remaining rows if less than 4 entries
    for (let i = count; i < 4; i++) {
        tbody.innerHTML += `<tr><td>-</td><td>-</td></tr>`;
    }

    document.getElementById("searchSection").style.display="none";
    document.getElementById("formSection").style.display="block";
}

function showLoading(){
    document.getElementById("loading").style.display="block";
    document.getElementById("searchBtn").disabled=true;
    document.getElementById("searchBtn").textContent="‡¶ñ‡ßÅ‡¶Å‡¶ú‡¶õ‡¶ø...";
}

function hideLoading(){
    document.getElementById("loading").style.display="none";
    document.getElementById("searchBtn").disabled=false;
    document.getElementById("searchBtn").textContent="‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®";
}

function showError(m){
    document.getElementById("error").textContent=m;
    document.getElementById("error").style.display="block";
    hideLoading();
}

function hideError(){ document.getElementById("error").style.display="none"; }

function showSearchSection(){
    document.getElementById("formSection").style.display="none";
    document.getElementById("searchSection").style.display="block";
}

function closeForm(){
    if(window.AndroidInterface){ AndroidInterface.closeApplication(); }
}

// Initial state setup (if needed)
document.addEventListener('DOMContentLoaded', () => {
    selectType(selectedType);
});

</script>
</body>
</html>
